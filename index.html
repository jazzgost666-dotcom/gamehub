<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Admin - OnyxChat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); align-items: center; justify-content: center; z-index: 50; }
        .modal.active { display: flex; }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen p-4 md:p-10">

    <div class="max-w-6xl mx-auto">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-extrabold text-blue-500">Admin Console</h1>
            <button onclick="location.reload()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded text-sm">Atualizar Lista</button>
        </div>
        
        <div class="overflow-x-auto bg-gray-800 rounded-xl shadow-2xl">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="border-b border-gray-700 bg-gray-700/50">
                        <th class="p-4">Capa</th>
                        <th class="p-4">Título</th>
                        <th class="p-4 text-center">Likes</th>
                        <th class="p-4 text-center">Views</th>
                        <th class="p-4 text-right">Ações</th>
                    </tr>
                </thead>
                <tbody id="gameList">
                    <tr><td colspan="5" class="p-10 text-center text-gray-400">Carregando dados do Firebase...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="editModal" class="modal">
        <div class="bg-gray-800 p-8 rounded-2xl w-full max-w-md border border-gray-700 shadow-2xl">
            <h2 class="text-2xl font-bold mb-6 text-blue-400">Editar Informações</h2>
            <input type="hidden" id="editId">
            
            <label class="block text-sm text-gray-400 mb-1">Título do Jogo</label>
            <input type="text" id="editTitle" class="w-full mb-4 p-3 rounded bg-gray-900 border border-gray-700 focus:border-blue-500 outline-none">
            
            <label class="block text-sm text-gray-400 mb-1">URL da Imagem (Capa)</label>
            <input type="text" id="editImage" class="w-full mb-4 p-3 rounded bg-gray-900 border border-gray-700 focus:border-blue-500 outline-none">
            
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Likes</label>
                    <input type="number" id="editLikes" class="w-full p-3 rounded bg-gray-900 border border-gray-700 outline-none">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Views</label>
                    <input type="number" id="editViews" class="w-full p-3 rounded bg-gray-900 border border-gray-700 outline-none">
                </div>
            </div>
            
            <div class="flex justify-end gap-3">
                <button onclick="closeModal()" class="px-5 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 transition">Cancelar</button>
                <button onclick="updateGame()" class="px-5 py-2 rounded-lg bg-blue-600 hover:bg-blue-500 transition font-bold">Salvar Alterações</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Configuração decodificada
        const firebaseConfig = {
            apiKey: "AIzaSyChPRJXA-qNZBVM6ooEcjUbB79xRW1XNAM",
            authDomain: "onyxchat-8ad6f.firebaseapp.com",
            projectId: "onyxchat-8ad6f",
            storageBucket: "onyxchat-8ad6f.firebasestorage.app",
            messagingSenderId: "896434555696",
            appId: "1:896434555696:web:76da6aef962e3916d816f5",
            measurementId: "G-SFJJHC5PM8"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const colName = "games"; // <--- VERIFIQUE SE O NOME DA COLEÇÃO É ESTE

        async function loadGames() {
            const list = document.getElementById('gameList');
            try {
                const querySnapshot = await getDocs(collection(db, colName));
                list.innerHTML = "";
                
                if (querySnapshot.empty) {
                    list.innerHTML = `<tr><td colspan="5" class="p-10 text-center text-yellow-500">Nenhum jogo encontrado na coleção "${colName}".</td></tr>`;
                    return;
                }

                querySnapshot.forEach((documento) => {
                    const game = documento.data();
                    const id = documento.id;
                    
                    list.innerHTML += `
                        <tr class="border-b border-gray-700 hover:bg-gray-750 transition">
                            <td class="p-4"><img src="${game.capa || ''}" class="w-16 h-10 object-cover rounded shadow-md border border-gray-600" onerror="this.src='https://via.placeholder.com/150'"></td>
                            <td class="p-4 font-medium">${game.titulo || 'Sem título'}</td>
                            <td class="p-4 text-center text-green-400">${game.likes || 0}</td>
                            <td class="p-4 text-center text-blue-400">${game.views || 0}</td>
                            <td class="p-4 text-right space-x-2">
                                <button onclick="openEdit('${id}', '${game.titulo}', '${game.capa}', ${game.likes || 0}, ${game.views || 0})" class="bg-yellow-600/20 text-yellow-500 hover:bg-yellow-600 hover:text-white px-3 py-1 rounded transition text-sm">Editar</button>
                                <button onclick="deleteGame('${id}')" class="bg-red-600/20 text-red-500 hover:bg-red-600 hover:text-white px-3 py-1 rounded transition text-sm">Apagar</button>
                            </td>
                        </tr>
                    `;
                });
            } catch (error) {
                console.error("Erro ao carregar:", error);
                list.innerHTML = `<tr><td colspan="5" class="p-10 text-center text-red-500">Erro de conexão: ${error.message}</td></tr>`;
            }
        }

        // Funções Globais
        window.openEdit = (id, titulo, capa, likes, views) => {
            document.getElementById('editId').value = id;
            document.getElementById('editTitle').value = titulo;
            document.getElementById('editImage').value = capa;
            document.getElementById('editLikes').value = likes;
            document.getElementById('editViews').value = views;
            document.getElementById('editModal').classList.add('active');
        };

        window.closeModal = () => document.getElementById('editModal').classList.remove('active');

        window.updateGame = async () => {
            const id = document.getElementById('editId').value;
            try {
                const docRef = doc(db, colName, id);
                await updateDoc(docRef, {
                    titulo: document.getElementById('editTitle').value,
                    capa: document.getElementById('editImage').value,
                    likes: Number(document.getElementById('editLikes').value),
                    views: Number(document.getElementById('editViews').value)
                });
                alert("Dados atualizados com sucesso!");
                closeModal();
                loadGames();
            } catch (error) {
                alert("Erro ao atualizar: " + error.message);
            }
        };

        window.deleteGame = async (id) => {
            if(confirm("Deseja realmente apagar este jogo permanentemente?")) {
                try {
                    await deleteDoc(doc(db, colName, id));
                    loadGames();
                } catch (error) {
                    alert("Erro ao deletar: " + error.message);
                }
            }
        };

        // Início
        loadGames();
    </script>
</body>
</html>
