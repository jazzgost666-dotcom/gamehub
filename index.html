<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OnyxChat - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); align-items: center; justify-content: center; z-index: 50; padding: 20px; }
        .modal.active { display: flex; }
        .bg-card { background: #1a1c23; border: 1px solid #2d2f39; }
    </style>
</head>
<body class="bg-[#0f1115] text-gray-200 min-h-screen">

    <div class="max-w-6xl mx-auto p-6">
        <header class="flex flex-col md:flex-row justify-between items-center mb-10 gap-4">
            <div>
                <h1 class="text-3xl font-black text-white tracking-tighter">ONYX<span class="text-blue-500">CHAT</span> ADMIN</h1>
                <p class="text-gray-500 text-sm">Gerenciamento de Jogos e Estatísticas</p>
            </div>
            <button onclick="openAddModal()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition-all shadow-lg shadow-blue-900/20">
                + Adicionar Novo Jogo
            </button>
        </header>

        <div class="bg-card rounded-2xl overflow-hidden shadow-2xl">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="bg-[#242630] text-gray-400 text-xs uppercase tracking-widest">
                        <th class="p-5">Capa</th>
                        <th class="p-5">Título</th>
                        <th class="p-5 text-center">Likes</th>
                        <th class="p-5 text-center">Views</th>
                        <th class="p-5 text-right">Ações</th>
                    </tr>
                </thead>
                <tbody id="gameList">
                    <tr><td colspan="5" class="p-20 text-center text-gray-500 animate-pulse">Conectando ao Firestore...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="gameModal" class="modal">
        <div class="bg-card p-8 rounded-2xl w-full max-w-md shadow-2xl">
            <h2 id="modalTitle" class="text-2xl font-bold mb-6 text-white">Editar Jogo</h2>
            
            <input type="hidden" id="gameId">
            
            <div class="space-y-4">
                <div>
                    <label class="text-xs text-gray-500 uppercase font-bold">Título do Jogo</label>
                    <input type="text" id="inpTitle" class="w-full bg-[#0f1115] border border-gray-700 p-3 rounded-lg focus:border-blue-500 outline-none">
                </div>
                <div>
                    <label class="text-xs text-gray-500 uppercase font-bold">URL da Imagem de Capa</label>
                    <input type="text" id="inpCapa" class="w-full bg-[#0f1115] border border-gray-700 p-3 rounded-lg focus:border-blue-500 outline-none">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs text-gray-500 uppercase font-bold">Likes</label>
                        <input type="number" id="inpLikes" class="w-full bg-[#0f1115] border border-gray-700 p-3 rounded-lg outline-none">
                    </div>
                    <div>
                        <label class="text-xs text-gray-500 uppercase font-bold">Views</label>
                        <input type="number" id="inpViews" class="w-full bg-[#0f1115] border border-gray-700 p-3 rounded-lg outline-none">
                    </div>
                </div>
            </div>
            
            <div class="flex justify-end gap-3 mt-8">
                <button onclick="closeModal()" class="text-gray-400 hover:text-white px-4">Cancelar</button>
                <button id="btnSave" onclick="saveData()" class="bg-blue-600 hover:bg-blue-500 text-white px-8 py-3 rounded-xl font-bold transition-all">
                    Salvar
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, updateDoc, deleteDoc, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // CONFIGURAÇÃO DIRETA (Já decodificada do seu _0xgh)
        const firebaseConfig = {
            apiKey: "AIzaSyChPRJXA-qNZBVM6ooEcjUbB79xRW1XNAM",
            authDomain: "onyxchat-8ad6f.firebaseapp.com",
            projectId: "onyxchat-8ad6f",
            storageBucket: "onyxchat-8ad6f.firebasestorage.app",
            messagingSenderId: "896434555696",
            appId: "1:896434555696:web:76da6aef962e3916d816f5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const colName = "games"; // IMPORTANTE: Sua coleção deve ter este nome no Firebase

        // Carregar Jogos
        async function loadGames() {
            const list = document.getElementById('gameList');
            try {
                const snapshot = await getDocs(collection(db, colName));
                list.innerHTML = "";
                
                if (snapshot.empty) {
                    list.innerHTML = `<tr><td colspan="5" class="p-10 text-center">Nenhum dado encontrado na coleção "${colName}". <br> Clique em "Adicionar Novo Jogo" para criar o primeiro.</td></tr>`;
                    return;
                }

                snapshot.forEach((gameDoc) => {
                    const data = gameDoc.data();
                    const id = gameDoc.id;
                    list.innerHTML += `
                        <tr class="border-b border-[#2d2f39] hover:bg-white/5 transition">
                            <td class="p-5"><img src="${data.capa}" class="w-14 h-14 object-cover rounded-lg bg-gray-800"></td>
                            <td class="p-5 font-bold text-white">${data.titulo}</td>
                            <td class="p-5 text-center text-blue-400 font-mono">${data.likes || 0}</td>
                            <td class="p-5 text-center text-purple-400 font-mono">${data.views || 0}</td>
                            <td class="p-5 text-right">
                                <button onclick="openEditModal('${id}', '${data.titulo}', '${data.capa}', ${data.likes}, ${data.views})" class="text-blue-500 hover:text-white mr-4">Editar</button>
                                <button onclick="deleteGame('${id}')" class="text-red-500 hover:text-white">Apagar</button>
                            </td>
                        </tr>
                    `;
                });
            } catch (e) {
                console.error(e);
                list.innerHTML = `<tr><td colspan="5" class="p-10 text-center text-red-500">Erro: ${e.message}</td></tr>`;
            }
        }

        // Funções de Interface
        window.closeModal = () => document.getElementById('gameModal').classList.remove('active');

        window.openAddModal = () => {
            document.getElementById('modalTitle').innerText = "Novo Jogo";
            document.getElementById('gameId').value = "";
            document.getElementById('inpTitle').value = "";
            document.getElementById('inpCapa').value = "";
            document.getElementById('inpLikes').value = 0;
            document.getElementById('inpViews').value = 0;
            document.getElementById('gameModal').classList.add('active');
        };

        window.openEditModal = (id, tit, cap, lik, vie) => {
            document.getElementById('modalTitle').innerText = "Editar Jogo";
            document.getElementById('gameId').value = id;
            document.getElementById('inpTitle').value = tit;
            document.getElementById('inpCapa').value = cap;
            document.getElementById('inpLikes').value = lik;
            document.getElementById('inpViews').value = vie;
            document.getElementById('gameModal').classList.add('active');
        };

        // Salvar (Adicionar ou Editar)
        window.saveData = async () => {
            const id = document.getElementById('gameId').value;
            const payload = {
                titulo: document.getElementById('inpTitle').value,
                capa: document.getElementById('inpCapa').value,
                likes: Number(document.getElementById('inpLikes').value),
                views: Number(document.getElementById('inpViews').value)
            };

            try {
                if (id) {
                    await updateDoc(doc(db, colName, id), payload);
                } else {
                    await addDoc(collection(db, colName), payload);
                }
                closeModal();
                loadGames();
            } catch (e) { alert("Erro ao salvar: " + e.message); }
        };

        // Apagar
        window.deleteGame = async (id) => {
            if(confirm("Deseja apagar este jogo?")) {
                await deleteDoc(doc(db, colName, id));
                loadGames();
            }
        };

        loadGames();
    </script>
</body>
</html>
