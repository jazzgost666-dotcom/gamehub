<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameDev Space - MEGA HUB</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, push, onValue, update, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAMHAKVot044psR421B_t-Ht5EmsueVS8A",
            authDomain: "game-dev-space.firebaseapp.com",
            databaseURL: "https://game-dev-space-default-rtdb.firebaseio.com",
            projectId: "game-dev-space",
            storageBucket: "game-dev-space.firebasestorage.app",
            messagingSenderId: "1073185335190",
            appId: "1:1073185335190:web:ae9ffd88cdf89f53cbdfb7"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        
        // Exportando funções para o Botão funcionar
        window.DB_HUB = db;
        window.FB_TOOLS = { ref, set, push, onValue, update, increment };
        console.log("SISTEMA DE DADOS CONECTADO");
    </script>

    <style>
        body { font-family: 'Rajdhani', sans-serif; background: #0b0915; color: white; margin: 0; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border: 1px solid rgba(139, 92, 246, 0.2); }
        .profile-banner { width: 100%; height: 200px; border-radius: 20px; background: #1a1625; position: relative; overflow: visible; margin-bottom: 60px; border: 1px solid #8b5cf633; }
        .profile-avatar { width: 100px; height: 100px; border-radius: 50%; border: 4px solid #8b5cf6; position: absolute; bottom: -50px; left: 30px; background: #000; background-size: cover; }
        .game-card { border-radius: 15px; background: #ffffff05; border: 1px solid #ffffff11; transition: 0.3s; cursor: pointer; }
        .game-card:hover { border-color: #8b5cf6; transform: translateY(-5px); }
        #game-viewer { display: none; position: fixed; inset: 0; background: #000; z-index: 9999; }
        .btn-pub { background: #8b5cf6; color: white; font-weight: 900; padding: 12px; border-radius: 12px; width: 100%; cursor: pointer; transition: 0.3s; }
        .btn-pub:hover { background: #a78bfa; box-shadow: 0 0 15px #8b5cf6; }
    </style>
</head>
<body>

    <div id="intro" class="fixed inset-0 bg-black z-[10000] flex flex-col items-center justify-center text-center">
        <h1 class="font-orbitron text-8xl font-black text-purple-600 animate-pulse">G</h1>
        <div class="mt-10 space-y-2 opacity-80 uppercase tracking-tighter text-xs">
            <p>Devs: BYTEZT & JHOSSMINE2</p>
            <p>Producer: EXILED OWNER</p>
            <p>Sub-Owner: CHAD</p>
        </div>
    </div>

    <div id="hub" class="hidden min-h-screen">
        <header class="p-4 glass sticky top-0 z-50 flex justify-between items-center">
            <h1 class="font-orbitron font-bold text-purple-500">GAMEDEV <span class="text-white">HUB</span></h1>
            <div class="flex gap-4">
                <button onclick="document.getElementById('m-up').classList.remove('hidden')" class="bg-purple-600 px-4 py-2 rounded-lg font-bold text-xs">POSTAR GAME</button>
                <div onclick="document.getElementById('m-prof').classList.remove('hidden')" id="nav-av" class="w-10 h-10 rounded-full border border-purple-500 bg-cover cursor-pointer"></div>
            </div>
        </header>

        <main class="p-8 container mx-auto">
            <div id="banner" class="profile-banner">
                <div id="av-main" class="profile-avatar"></div>
            </div>

            <h2 class="text-2xl font-black italic mb-6 uppercase">Biblioteca da Comunidade</h2>
            <div id="grid" class="grid grid-cols-1 md:grid-cols-4 gap-6"></div>
        </main>
    </div>

    <div id="game-viewer">
        <div class="flex flex-col h-full">
            <div class="p-4 glass flex justify-between">
                <button onclick="location.reload()" class="bg-red-600 px-4 py-1 rounded font-bold">FECHAR JOGO</button>
                <button onclick="document.getElementById('ifr').requestFullscreen()" class="bg-purple-600 px-4 py-1 rounded font-bold">TELA CHEIA</button>
            </div>
            <iframe id="ifr" class="flex-1 w-full border-none bg-white"></iframe>
        </div>
    </div>

    <div id="m-up" class="hidden fixed inset-0 bg-black/90 z-[1000] flex items-center justify-center p-4">
        <div class="glass p-8 rounded-2xl w-full max-w-lg">
            <h3 class="text-xl font-bold mb-4 text-purple-500">NOVO PROJETO</h3>
            <div class="space-y-4">
                <input type="text" id="name" placeholder="Nome do Jogo" class="w-full bg-white/5 p-3 rounded border border-white/10 outline-none">
                <input type="text" id="capa" placeholder="URL da Capa" class="w-full bg-white/5 p-3 rounded border border-white/10 outline-none">
                <select id="type" class="w-full bg-black p-3 rounded border border-white/10 text-purple-400">
                    <option value="url">Link (URL)</option>
                    <option value="code">Código HTML</option>
                </select>
                <textarea id="cont" placeholder="Conteúdo aqui..." class="w-full bg-white/5 p-3 rounded border border-white/10 h-32 outline-none"></textarea>
                <button onclick="publicarAgora()" class="btn-pub">PUBLICAR AGORA</button>
                <button onclick="document.getElementById('m-up').classList.add('hidden')" class="w-full text-xs opacity-50">CANCELAR</button>
            </div>
        </div>
    </div>

    <div id="m-prof" class="hidden fixed inset-0 bg-black/90 z-[1000] flex items-center justify-center p-4">
        <div class="glass p-8 rounded-2xl w-full max-w-sm">
            <h3 class="font-bold mb-4">EDITAR PERFIL</h3>
            <input type="text" id="p-n" placeholder="Nome" class="w-full bg-white/5 p-3 rounded border border-white/10 mb-2">
            <input type="text" id="p-a" placeholder="URL Avatar" class="w-full bg-white/5 p-3 rounded border border-white/10 mb-2">
            <input type="text" id="p-b" placeholder="URL Banner" class="w-full bg-white/5 p-3 rounded border border-white/10 mb-4">
            <button onclick="salvarPerfil()" class="btn-pub">SALVAR</button>
        </div>
    </div>

    <script>
        let user = JSON.parse(localStorage.getItem('user_hub')) || { name: 'Player', av: '', bn: '', id: Date.now() };

        window.onload = () => {
            setTimeout(() => {
                document.getElementById('intro').style.display = 'none';
                document.getElementById('hub').classList.remove('hidden');
                carregarJogos();
                atualizarTela();
            }, 10000);
        };

        function atualizarTela() {
            document.getElementById('nav-av').style.backgroundImage = `url(${user.av})`;
            document.getElementById('av-main').style.backgroundImage = `url(${user.av})`;
            if(user.bn) document.getElementById('banner').style.backgroundImage = `url(${user.bn})`;
            localStorage.setItem('user_hub', JSON.stringify(user));
        }

        function salvarPerfil() {
            user.name = document.getElementById('p-n').value || user.name;
            user.av = document.getElementById('p-a').value || user.av;
            user.bn = document.getElementById('p-b').value || user.bn;
            atualizarTela();
            document.getElementById('m-prof').classList.add('hidden');
        }

        function publicarAgora() {
            const { ref, push, set } = window.FB_TOOLS;
            const n = document.getElementById('name').value;
            const c = document.getElementById('capa').value;
            const t = document.getElementById('type').value;
            const co = document.getElementById('cont').value;

            if(!n || !co) return alert("Preencha o nome e o conteúdo!");

            const novoJogo = push(ref(window.DB_HUB, 'games'));
            set(novoJogo, {
                name: n,
                capa: c || 'https://via.placeholder.com/300x150',
                type: t,
                content: co,
                author: user.name,
                authorId: user.id,
                likes: 0
            }).then(() => {
                alert("SUCESSO! Jogo postado na Biblioteca.");
                location.reload();
            }).catch(e => {
                console.error(e);
                alert("ERRO AO POSTAR: " + e.message);
            });
        }

        function carregarJogos() {
            const { ref, onValue } = window.FB_TOOLS;
            onValue(ref(window.DB_HUB, 'games'), (snap) => {
                const g = document.getElementById('grid');
                g.innerHTML = "";
                const data = snap.val();
                if(!data) return;
                Object.keys(data).reverse().forEach(id => {
                    const j = data[id];
                    g.innerHTML += `
                        <div class="game-card p-4" onclick="jogar('${id}')">
                            <img src="${j.capa}" class="w-full h-32 object-cover rounded-lg mb-2">
                            <h4 class="font-bold truncate">${j.name}</h4>
                            <p class="text-[10px] opacity-50">POR: ${j.author}</p>
                        </div>
                    `;
                });
            });
        }

        function jogar(id) {
            const { ref, onValue } = window.FB_TOOLS;
            onValue(ref(window.DB_HUB, `games/${id}`), (snap) => {
                const j = snap.val();
                const ifr = document.getElementById('ifr');
                if(j.type === 'url') ifr.src = j.content;
                else ifr.srcdoc = j.content;
                document.getElementById('game-viewer').style.display = 'block';
            }, { onlyOnce: true });
        }
    </script>
</body>
</html>
