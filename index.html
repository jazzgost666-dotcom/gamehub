<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PugHall | Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #1a1512; }
        .font-pug { font-family: 'Fredoka', sans-serif; }
        .bg-pug { background-color: #1e1814; border: 1px solid #3e2f26; }
        .accent-pug { color: #e67e22; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); align-items: center; justify-content: center; z-index: 50; }
        .modal.active { display: flex; }
    </style>
</head>
<body class="text-white p-6">

    <div class="max-w-6xl mx-auto">
        <header class="flex justify-between items-center mb-10 border-b-2 border-[#e67e22] pb-4">
            <h1 class="text-3xl font-pug font-bold accent-pug uppercase tracking-wider">üêæ PugHall Admin</h1>
            <div class="text-sm text-gray-400">Gerenciando Cole√ß√£o: <span class="text-[#f1c40f]">games</span></div>
        </header>

        <div class="bg-pug rounded-xl overflow-hidden shadow-2xl">
            <table class="w-full text-left">
                <thead class="bg-[#3e2f26] text-[#d2b48c] text-xs uppercase">
                    <tr>
                        <th class="p-4">Capa</th>
                        <th class="p-4">Jogo</th>
                        <th class="p-4 text-center">Likes/Views</th>
                        <th class="p-4 text-right">A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="gameList">
                    <tr><td colspan="4" class="p-10 text-center text-gray-500 italic">Buscando pugs no banco de dados...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="editModal" class="modal">
        <div class="bg-[#1e1814] p-8 rounded-2xl w-full max-w-md border-2 border-[#e67e22]">
            <h2 class="text-2xl font-pug font-bold mb-6 accent-pug">Editar Jogo</h2>
            <input type="hidden" id="editId">
            
            <div class="space-y-4">
                <div>
                    <label class="text-xs text-[#d2b48c] font-bold uppercase">T√≠tulo</label>
                    <input type="text" id="editTitle" class="w-full bg-[#0d1117] border border-[#3e2f26] p-3 rounded-lg outline-none focus:border-[#e67e22]">
                </div>
                <div>
                    <label class="text-xs text-[#d2b48c] font-bold uppercase">URL da Capa</label>
                    <input type="text" id="editCapa" class="w-full bg-[#0d1117] border border-[#3e2f26] p-3 rounded-lg outline-none focus:border-[#e67e22]">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs text-[#d2b48c] font-bold uppercase">Likes</label>
                        <input type="number" id="editLikes" class="w-full bg-[#0d1117] border border-[#3e2f26] p-3 rounded-lg outline-none">
                    </div>
                    <div>
                        <label class="text-xs text-[#d2b48c] font-bold uppercase">Views</label>
                        <input type="number" id="editViews" class="w-full bg-[#0d1117] border border-[#3e2f26] p-3 rounded-lg outline-none">
                    </div>
                </div>
            </div>
            
            <div class="flex justify-end gap-3 mt-8">
                <button onclick="closeModal()" class="text-gray-400 hover:text-white px-4 font-bold">CANCELAR</button>
                <button onclick="updateGame()" class="bg-[#e67e22] hover:bg-[#d35400] text-white px-6 py-2 rounded-lg font-bold transition-all">SALVAR</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Sua config
        const firebaseConfig = {
            apiKey: "AIzaSyChPRJXA-qNZBVM6ooEcjUbB79xRW1XNAM",
            authDomain: "onyxchat-8ad6f.firebaseapp.com",
            projectId: "onyxchat-8ad6f",
            storageBucket: "onyxchat-8ad6f.firebasestorage.app",
            messagingSenderId: "896434555696",
            appId: "1:896434555696:web:76da6aef962e3916d816f5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const colName = "games"; // Cole√ß√£o onde o PugHall salva os jogos

        async function loadGames() {
            const list = document.getElementById('gameList');
            try {
                const snapshot = await getDocs(collection(db, colName));
                list.innerHTML = "";
                
                if (snapshot.empty) {
                    list.innerHTML = `<tr><td colspan="4" class="p-10 text-center text-gray-500">Nenhum jogo encontrado na cole√ß√£o "${colName}".</td></tr>`;
                    return;
                }

                snapshot.forEach((gDoc) => {
                    const data = gDoc.data();
                    const id = gDoc.id;
                    list.innerHTML += `
                        <tr class="border-b border-[#3e2f26] hover:bg-[#e67e22]/5 transition">
                            <td class="p-4"><img src="${data.capa}" class="w-16 h-12 object-cover rounded-md border border-[#3e2f26]"></td>
                            <td class="p-4 font-bold text-[#d2b48c]">${data.titulo}</td>
                            <td class="p-4 text-center">
                                <span class="text-red-400">‚ù§Ô∏è ${data.likes || 0}</span> | 
                                <span class="text-blue-400">üëÅÔ∏è ${data.views || 0}</span>
                            </td>
                            <td class="p-4 text-right">
                                <button onclick="openEdit('${id}', '${data.titulo}', '${data.capa}', ${data.likes || 0}, ${data.views || 0})" class="text-[#f1c40f] hover:underline mr-4 font-bold">Editar</button>
                                <button onclick="deleteGame('${id}')" class="text-red-500 hover:underline font-bold">Apagar</button>
                            </td>
                        </tr>
                    `;
                });
            } catch (e) {
                list.innerHTML = `<tr><td colspan="4" class="p-10 text-center text-red-500">Erro: ${e.message}</td></tr>`;
            }
        }

        window.openEdit = (id, tit, cap, lik, vie) => {
            document.getElementById('editId').value = id;
            document.getElementById('editTitle').value = tit;
            document.getElementById('editCapa').value = cap;
            document.getElementById('editLikes').value = lik;
            document.getElementById('editViews').value = vie;
            document.getElementById('editModal').classList.add('active');
        };

        window.closeModal = () => document.getElementById('editModal').classList.remove('active');

        window.updateGame = async () => {
            const id = document.getElementById('editId').value;
            const ref = doc(db, colName, id);
            await updateDoc(ref, {
                titulo: document.getElementById('editTitle').value,
                capa: document.getElementById('editCapa').value,
                likes: Number(document.getElementById('editLikes').value),
                views: Number(document.getElementById('editViews').value)
            });
            closeModal();
            loadGames();
        };

        window.deleteGame = async (id) => {
            if(confirm("Deseja apagar este jogo do PugHall?")) {
                await deleteDoc(doc(db, colName, id));
                loadGames();
            }
        };

        loadGames();
    </script>
</body>
</html>
